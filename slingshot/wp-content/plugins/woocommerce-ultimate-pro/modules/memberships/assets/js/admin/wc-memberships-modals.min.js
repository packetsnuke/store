(function(){"use strict";jQuery(document).ready(function(a){var b,c,d,e,f,g;if(g=null!=(c=window.wc_memberships_admin)?c:{},f=null!=(d=window.typenow)?d:"",b=null!=(e=window.pagenow)?e:"",window.WC_Memberships_Member_Modal_View=WC_Memberships_Modal_View.extend({render:function(){return WC_Memberships_Member_Modal_View.__super__.render.apply(this,arguments),this.$("#wc-memberships-member-modal-user-source").trigger("change"),a(document.body).trigger("wc-enhanced-select-init")},events:function(){return _.extend({},WC_Memberships_Member_Modal_View.__super__.events,{"change #wc-memberships-member-modal-user-source":"toggleSourceFields"})},setError:function(a){return this.$("#wc-memberships-member-modal-response").html('<div class="wc-memberships-modal-error"><span>'+a+"</span></div>")},clearError:function(){return this.$("#wc-memberships-modal-response").html("")},toggleSourceFields:function(b){var c,d;return this.clearError(),d=this.$("#wc-memberships-modal-select-existing-user"),c=this.$("#wc-memberships-modal-create-new-user"),"existing"===a(b.target).val()?(d.show(),c.hide()):(d.hide(),c.show())},createUser:function(b){var c;return c=a.extend({},this.getNewUserData(),{action:"wc_memberships_create_user_for_membership",security:g.create_user_for_membership_nonce}),a.post(g.ajax_url,c,b)},getNewUserData:function(){var a;return a=this.$("#wc-memberships-member-modal-password"),{username:this.$("#wc-memberships-member-modal-user-login").val(),email:this.$("#wc-memberships-member-modal-user-email").val(),first_name:this.$("#wc-memberships-member-modal-user-first-name").val(),last_name:this.$("#wc-memberships-member-modal-user-last-name").val(),password:a?a.val():""}},validateAndHandle:function(a,b){return!a||""===a||parseInt(a,10)<=0?(this.setError(g.i18n.please_select_user),this.unblock()):this.handleAction(a,b)},addButton:function(a){var b,c,d;return d=this,a.preventDefault(),b=this.$("#wc-memberships-member-modal-user-source").val(),this.clearError(),this.block(),"existing"===b?(c=this.$("#search_member_id").val(),this.validateAndHandle(c,b)):"new"===b?this.createUser(function(a){if(a&&a.data)return a.success?d.validateAndHandle(a.data,b):(d.setError(a.data),d.unblock())}):void 0}}),window.WC_Memberships_Modal_View_Add_User_Membership=WC_Memberships_Member_Modal_View.extend({template_id:"wc-memberships-modal-add-user-membership",handleAction:function(b){return a(document.body).trigger("wc_backbone_modal_response",[this._target,{user:b}]),window.location=g.new_membership_url+"&user="+b}}),window.WC_Memberships_Modal_View_Transfer_User_Membership=WC_Memberships_Member_Modal_View.extend({template_id:"wc-memberships-modal-transfer-user-membership",initialize:function(a){return this.user_id=parseInt(a.user_id,10),this.membership_id=parseInt(a.membership_id,10),WC_Memberships_Modal_View_Transfer_User_Membership.__super__.initialize.apply(this,arguments)},handleAction:function(b){var c,d;return d=this,c={action:"wc_memberships_transfer_user_membership",security:g.transfer_user_membership_nonce,membership:this.membership_id,prev_user:this.user_id,new_user:b},a.post(g.ajax_url,c,function(c){return c.success?(a(document.body).trigger("wc_backbone_modal_response",[d._target,{membership:d.membership_id,prev_user:d.user_id,new_user:b}]),location.reload()):(d.setError(c.data),d.unblock())})}}),"edit-wc_user_membership"!==b&&"wc_user_membership"!==b||a("div.wrap > a.page-title-action").on("click",function(a){return a.preventDefault(),new WC_Memberships_Modal_View_Add_User_Membership}),"wc_user_membership"===f)return a("#transfer-action a").on("click",function(b){var c;return b.preventDefault(),c=a(this),new WC_Memberships_Modal_View_Transfer_User_Membership({user_id:c.data("user-id"),membership_id:c.data("membership-id")})})})}).call(this);