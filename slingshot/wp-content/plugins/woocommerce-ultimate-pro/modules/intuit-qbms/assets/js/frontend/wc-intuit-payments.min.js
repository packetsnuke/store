(function(){jQuery(document).ready(function(a){"use strict";return window.WC_Intuit_Payments_Tokenization_Handler=function(){function b(){this.params=window.wc_intuit_payments_params,a(document.body).on("sv_wc_payment_form_valid_payment_data",function(a){return function(b,c){return a.init(b,c)}}(this)),a(document.body).on("checkout_error",function(b){return function(c){return a("input[name=wc-"+b.payment_form.id_dasherized+"-js-token]").val("")}}(this)),a(document.body).on("updated_checkout",function(a){return function(){return a.handle_saved_payment_methods()}}(this))}return b.prototype.init=function(a,b){var c;if(this.payment_form=b.payment_form,("intuit_payments_credit_card"===(c=this.payment_form.id)||"intuit_payments_echeck"===c)&&!this.payment_form.saved_payment_method_selected&&b.passed_validation)return!!this.has_token()||("intuit_payments_credit_card"===this.payment_form.id?this.tokenize_method("credit_card"):this.tokenize_method("echeck"),!1)},b.prototype.tokenize_method=function(b){var c;return this.payment_form.block_ui(),c=this.get_request_data(b),this.log_data(c,"request"),a.ajax(this.params.api_url,{method:"POST",dataType:"json",contentType:"application/json",crossDomain:!0,data:JSON.stringify(c),success:function(a){return function(b){return a.handle_response(b)}}(this),error:function(a){return function(b){return a.handle_response(b.responseJSON)}}(this)})},b.prototype.get_request_data=function(b){var c,d,e,f,g,h,i,j;return c=a("input[id=wc-"+this.payment_form.id_dasherized+"-account-number]").val(),j=a("input[name=billing_first_name]").val()+" "+a("input[name=billing_last_name]").val(),e=a("#billing_country").val(),"credit_card"===b?(a("select[name=wc-"+this.payment_form.id_dasherized+"-test-case]").val()&&(j=a("select[name=wc-"+this.payment_form.id_dasherized+"-test-case]").val()),i=a("input[name=wc-"+this.payment_form.id_dasherized+"-expiry]").payment("cardExpiryVal"),g=i.month.toString(),h=i.year.toString(),1===g.length&&(g="0"+g),f={card:{expYear:h,expMonth:g,name:j.substring(0,30),cvc:a("input[id=wc-"+this.payment_form.id_dasherized+"-csc]").val(),number:c}},e&&(f.card.address={region:a("#billing_state").val().substring(0,30),postalCode:a("input[name=billing_postcode]").val().substring(0,10),streetAddress:a("input[name=billing_address_1]").val().substring(0,30),country:e.substring(0,2),city:a("#billing_city").val().substring(0,30)})):(d=a("#wc-"+this.payment_form.id_dasherized+"-account-type").val(),"checking"===d?d="PERSONAL_CHECKING":"savings"===d&&(d="PERSONAL_SAVINGS"),f={bankAccount:{name:j.substring(0,30),routingNumber:a("input[id=wc-"+this.payment_form.id_dasherized+"-routing-number]").val(),accountNumber:c,accountType:d}},e&&(f.bankAccount.country=e.substring(0,2)),a("input[name=billing_phone]").length&&(f.bankAccount.phone=a("input[name=billing_phone]").val().replace(/\D/g,""))),f},b.prototype.handle_response=function(a){return this.log_data(a,"response"),null!=a.value?(this.set_token(a.value),this.payment_form.form.submit()):(a.errors&&console.error(a.errors),this.payment_form.render_errors([this.params.generic_error]),this.payment_form.unblock_ui())},b.prototype.set_token=function(b){var c,d;return a("input[name=wc-"+this.payment_form.id_dasherized+"-js-token]").val(b),d=a("input[id=wc-"+this.payment_form.id_dasherized+"-account-number]").val().slice(-4),a("input[name=wc-"+this.payment_form.id_dasherized+"-last-four]").val(d),c=a.payment.cardType(a("input[id=wc-"+this.payment_form.id_dasherized+"-account-number]").val()),a("input[name=wc-"+this.payment_form.id_dasherized+"-card-type]").val(c)},b.prototype.has_token=function(){return a("input[name=wc-"+this.payment_form.id_dasherized+"-js-token]").val()},b.prototype.handle_saved_payment_methods=function(){var b;return b="js-sv-wc-payment-gateway-credit-card-form-csc",a("input.js-wc-intuit-payments-credit-card-payment-token").change(function(){var c;return c=a("#wc-intuit-payments-credit-card-credit-card-form"),a("input.js-wc-intuit-payments-credit-card-payment-token:checked").val()?(c.hide(),a("#wc-intuit-payments-credit-card-csc").removeClass(b)):(a("#wc-intuit-payments-credit-card-csc").addClass(b),c.show())})},b.prototype.log_data=function(b,c){var d,e,f;if(this.params.ajax_log){if(f={},b.card){for(e in b.card)f[e]=b.card[e];"number"in f&&(f.number=f.number.replace(/\d(?=\d{4})/g,"*")),"cvc"in f&&(f.cvc=f.cvc.replace(/[0-9]/g,"*"))}if(b.bankAccount){for(e in b.bankAccount)f[e]=b.bankAccount[e];"accountNumber"in f&&(f.accountNumber=f.accountNumber.replace(/\d(?=\d{4})/g,"*")),"routingNumber"in f&&(f.routingNumber=f.routingNumber.replace(/[0-9]/g,"*"))}return d={action:"wc_"+this.payment_form.plugin_id+"_log_js_data",gateway_id:this.payment_form.id,security:this.params.ajax_log_nonce,type:c,data:f},a.ajax({url:this.params.ajax_url,data:d})}},b}(),window.wc_intuit_payments_tokenization_handler=new WC_Intuit_Payments_Tokenization_Handler})}).call(this);