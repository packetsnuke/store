jQuery(function(t){function e(t){var e=this;this.$el=t,this.$content=t.find(".bto_group_data"),this.$metabox_title=t.find("h3 .group_name"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".tab_group"),this.$discount=this.$content.find(".group_discount"),this.$filters=this.$content.find(".group_filters"),this.$query_type_containers=this.$content.find(".bto_query_type_selector"),this.$query_type_selector=this.$content.find("select.bto_query_type"),this.$title_input=this.$content.find("input.group_title"),this.$priced_individually_input=this.$content.find(".group_priced_individually input"),this.$show_filters_input=this.$content.find(".group_show_filters input"),this.section_changed=function(t){e.$section_links.removeClass("current"),t.addClass("current"),e.$sections.addClass("tab_group_hidden"),e.$content.find(".tab_group_"+t.data("tab")).removeClass("tab_group_hidden")},this.title_changed=function(){e.$metabox_title.text(e.$title_input.val())},this.query_type_changed=function(){e.$query_type_containers.hide(),e.$content.find(".bto_query_type_"+e.$query_type_selector.val()).show()},this.priced_individually_input_changed=function(){e.$priced_individually_input.is(":checked")?e.$discount.show():e.$discount.hide()},this.show_filters_input_changed=function(){e.$show_filters_input.is(":checked")?e.$filters.show():e.$filters.hide()},this.initialize=function(){e.query_type_changed(),e.priced_individually_input_changed(),e.show_filters_input_changed()},this.initialize()}function n(){g.length>0?u.removeClass("disabled"):u.addClass("disabled")}function o(){h.on("click",".subsubsub a",function(e){var n=t(this),o=t(this).closest(".bto_group").data("component_metabox_id");w[o].section_changed(n),e.preventDefault()}).on("click","a.remove_row",function(e){var n=t(this).closest(".bto_group"),o=n.data("component_metabox_id");n.find("*").off(),n.remove(),delete w[o],m.triggerHandler("wc-cp-components-changed"),e.preventDefault()}).on("keyup","input.group_title",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");w[e].title_changed()}).on("change","select.bto_query_type",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");w[e].query_type_changed()}).on("change",".group_priced_individually input",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");w[e].priced_individually_input_changed()}).on("change",".group_show_filters input",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");w[e].show_filters_input_changed()}).on("click",".upload_component_image_button",function(e){q.$button=t(this),e.preventDefault(),q.image_frame?q.image_frame.open():(q.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),q.image_frame.on("select",function(){var t=q.image_frame.state().get("selection").first().toJSON(),e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;q.$button.addClass("has_image"),q.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),q.$button.find("input").val(t.id).change(),q.$button.find("img").eq(0).attr("src",e)}),q.image_frame.open())}).on("click",".remove_component_image_button",function(e){var n=t(this),o=n.closest(".component_image"),i=o.find(".upload_component_image_button");e.preventDefault(),i.removeClass("has_image"),n.removeClass("has_image"),o.find("input").val("").change(),i.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)}),m.on("click","button.add_bto_group",function(){m.block(S),b++;var n={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:b,security:wc_composite_admin_params.add_component_nonce};return setTimeout(function(){t.post(woocommerce_admin_meta_boxes.ajax_url,n,function(n){f.append(n);var o=t(".bto_group",f).last(),i=new e(o),a="component_"+b;o.data("component_metabox_id",a),w[a]=i,m.triggerHandler("wc-cp-components-changed"),o.wc_cp_select2(),o.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),m.triggerHandler("wc-cp-component-added",[i]),m.unblock()})},250),!1})}function i(){f.sortable({items:".bto_group",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),m.triggerHandler("wc-cp-components-changed")}}),n()}function a(){w={},g.each(function(n){var o=t(this),i="component_"+n;o.data("component_metabox_id",i),w[i]=new e(o)}),i()}function c(t){var e=this;this.$el=t,this.$content=t.find(".bto_scenario_data"),this.$metabox_title=t.find("h3 .scenario_name"),this.$title_input=this.$content.find("input.scenario_title"),this.$conditional_components_action_input=this.$content.find(".toggle_conditional_components input"),this.$conditional_components_action_config=this.$content.find(".scenario_action_conditional_components_group .action_components"),this.title_changed=function(){e.$metabox_title.text(e.$title_input.val())},this.component_modifier_changed=function(t){"masked"===t.val()?t.closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideUp(200):t.closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideDown(200)},this.conditional_components_action_input_changed=function(){e.$conditional_components_action_input.is(":checked")?e.$conditional_components_action_config.slideDown(200):e.$conditional_components_action_config.slideUp(200)},this.initialize=function(){},this.initialize()}function _(){$.length>0?y.removeClass("disabled"):y.addClass("disabled")}function s(){v.on("click","a.remove_row",function(e){var n=t(this).closest(".bto_scenario"),o=n.data("scenario_metabox_id");n.find("*").off(),n.remove(),delete C[o],v.triggerHandler("wc-cp-scenarios-changed"),e.preventDefault()}).on("keyup","input.scenario_title",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id");C[e].title_changed()}).on("change","select.bto_scenario_exclude",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id");C[e].component_modifier_changed(t(this))}).on("change",".toggle_conditional_components input",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id");C[e].conditional_components_action_input_changed()}).on("click","button.add_bto_scenario",function(){v.block(S),k++;var e={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:k,security:wc_composite_admin_params.add_scenario_nonce};return setTimeout(function(){t.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){x.append(e);var n=t(".bto_scenario",x).last(),o=new c(n),i="scenario_"+k;n.data("scenario_metabox_id",i),C[i]=o,v.triggerHandler("wc-cp-scenarios-changed"),n.wc_cp_select2(),n.wc_cp_select2_component_options(),n.find(".tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),v.triggerHandler("wc-cp-scenario-added",[o]),v.unblock()})},250),!1})}function r(){x.sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),v.triggerHandler("wc-cp-scenarios-changed")}}),_()}function d(){C={},$.each(function(e){var n=t(this),o="scenario_"+e;n.data("scenario_metabox_id",o),C[o]=new c(n)}),r()}var p={language:{errorLoading:function(){return wc_composite_admin_params.i18n_ajax_error},inputTooLong:function(t){var e=t.input.length-t.maximum;return 1===e?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",e)},inputTooShort:function(t){var e=t.minimum-t.input.length;return 1===e?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",e)},loadingMore:function(){return wc_composite_admin_params.i18n_load_more},maximumSelected:function(t){return 1===t.maximum?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",t.maximum)},noResults:function(){return wc_composite_admin_params.i18n_no_matches},searching:function(){return wc_composite_admin_params.i18n_searching}}},l={formatMatches:function(t){return 1===t?wc_composite_admin_params.i18n_matches_1:wc_composite_admin_params.i18n_matches_n.replace("%qty%",t)},formatNoMatches:function(){return wc_composite_admin_params.i18n_no_matches},formatAjaxError:function(){return wc_composite_admin_params.i18n_ajax_error},formatInputTooShort:function(t,e){var n=e-t.length;return 1===n?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",n)},formatInputTooLong:function(t,e){var n=t.length-e;return 1===n?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",n)},formatSelectionTooBig:function(t){return 1===t?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",t)},formatLoadMore:function(){return wc_composite_admin_params.i18n_load_more},formatSearching:function(){return wc_composite_admin_params.i18n_searching}};t.fn.wc_cp_select2=function(){t(document.body).trigger("wc-enhanced-select-init")},t.fn.wc_cp_select2_component_options=function(){"yes"===wc_composite_admin_params.is_wc_version_gte_2_7?t(":input.wc-component-options-search",this).filter(":not(.enhanced)").each(function(){var e=t(this).data("action"),n=t(this),o={allowClear:!!t(this).data("allow_clear"),placeholder:t(this).data("placeholder"),minimumInputLength:t(this).data("minimum_input_length")?t(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(n){return{term:n.term,action:e,security:wc_enhanced_select_params.search_products_nonce,exclude:t(this).data("exclude"),include:t(this).data("include"),limit:t(this).data("limit")}},processResults:function(e){var o=[];return"yes"===n.data("component_optional")&&0===n.find('option[value="-1"]').length&&o.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===n.find('option[value="0"]').length&&o.push({id:"0",text:wc_composite_admin_params.i18n_all}),e&&t.each(e,function(t,e){o.push({id:t,text:e})}),{results:o}},cache:!0}};o=t.extend(o,p),t(this).select2(o).addClass("enhanced")}):t(this).find(":input.wc-component-options-search").filter(":not(.enhanced)").each(function(){var e=t(this).data("action"),n=t(this),o={allowClear:!!t(this).data("allow_clear"),placeholder:t(this).data("placeholder"),minimumInputLength:t(this).data("minimum_input_length")?t(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(n){return{term:n,action:e,security:woocommerce_admin_meta_boxes.search_products_nonce,exclude:t(this).data("exclude"),include:t(this).data("include"),limit:t(this).data("limit")}},results:function(e){var o=[];return"yes"===n.data("component_optional")&&0===n.find('option[value="-1"]').length&&o.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===n.find('option[value="0"]').length&&o.push({id:"0",text:wc_composite_admin_params.i18n_all}),e&&t.each(e,function(t,e){o.push({id:t,text:e})}),{results:o}},cache:!0}};!0===t(this).data("multiple")?(o.multiple=!0,o.initSelection=function(e,n){var o=t.parseJSON(e.attr("data-selected")),i=[];return t(e.val().split(",")).each(function(t,e){i.push({id:e,text:o[e]})}),n(i)},o.formatSelection=function(t){return'<div class="selected-option" data-id="'+t.id+'">'+t.text+"</div>"}):(o.multiple=!1,o.initSelection=function(t,e){return e({id:t.val(),text:t.attr("data-selected")})}),o=t.extend(o,l),t(this).select2(o).addClass("enhanced")})};var m=t("#bto_product_data"),u=m.find(".bulk_toggle_wrapper"),h=t(".config_group",m),f=t(".bto_groups",h),g=t(".bto_group",f),b=g.length,w={},v=t("#bto_scenario_data"),y=v.find(".bulk_toggle_wrapper"),x=t(".bto_scenarios",v),$=t(".bto_scenario",x),k=$.length,C={},q={image_frame:!1,$button:!1},S={message:null,overlayCSS:{background:"#fff",opacity:.6}};t(".composite_stock_msg").appendTo("._manage_stock_field .description"),t("#_sold_individually").closest(".form-field").addClass("hide_if_composite"),t("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),t(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),t("body").on("woocommerce-product-type-change",function(e,n){"composite"===n&&(t(".show_if_external").hide(),t(".show_if_composite").show(),t("input#_manage_stock").change(),"no"===wc_composite_admin_params.is_wc_version_gte_2_7&&(t("#_regular_price").val(t("#_wc_cp_base_regular_price").val()).change(),t("#_sale_price").val(t("#_wc_cp_base_sale_price").val()).change()))}),t("select#product-type").change(),t("input#_downloadable").change(function(){t("select#product-type").change()}),t(".bundle_group .bto_layouts",m).on("click",".bto_layout_label",function(){t(this).closest(".bto_layouts").find(".selected").removeClass("selected"),t(this).addClass("selected")}),m.on("wc-cp-components-changed",function(){f=t(".bto_groups",h),(g=t(".bto_group",f)).each(function(e,n){t(".group_position",n).val(e),t(n).attr("rel",e)}),n()}),v.on("wc-cp-scenarios-changed",function(){x=t(".bto_scenarios",v),($=t(".bto_scenario",x)).each(function(e,n){t(".scenario_position",n).val(e),t(n).attr("rel",e)}),_()}),o(),a(),i(),h.wc_cp_select2_component_options(),s(),d(),r(),v.wc_cp_select2_component_options(),t(".save_composition").on("click",function(){m.block(S),v.block(S),g.find("*").off();var e={post_id:woocommerce_admin_meta_boxes.post_id,data:t("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};setTimeout(function(){t.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){var n=window.location.toString();n=n.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),t.get(n,function(n){var o=[],c=[],_=t("#bto_config_group_inner",m),s=t("#bto_scenarios_inner",v),p=t(n).find("#bto_config_group_inner"),l=p.find(".bto_group"),h=t(n).find("#bto_scenarios_inner"),f=h.find(".bto_scenario");g.length===l.length&&g.each(function(){var e=t(this);if(e.hasClass("open")){var n=e.attr("rel");o.push(n)}}),l.each(function(){var e=t(this),n=e.attr("rel");-1!==t.inArray(n,o)?(e.addClass("open").removeClass("closed"),e.find(".wc-metabox-content").show()):e.find(".wc-metabox-content").hide()}),$.length===f.length&&s.find(".bto_scenario").each(function(){var e=t(this);if(e.hasClass("open")){var n=e.attr("rel");c.push(n)}}),f.each(function(){var e=t(this),n=e.attr("rel");-1!==t.inArray(n,c)?(e.addClass("open").removeClass("closed"),e.find(".wc-metabox-content").show()):e.find(".wc-metabox-content").hide()}),g.find("*").off(),$.find("*").off(),_.html(p.html()),s.html(h.html()),u=_.find(".bulk_toggle_wrapper"),y=s.find(".bulk_toggle_wrapper"),m.triggerHandler("wc-cp-components-changed"),a(),i(),v.triggerHandler("wc-cp-scenarios-changed"),d(),r(),t("#bto_product_data .woocommerce-help-tip, #bto_scenario_data .woocommerce-help-tip, #bto_scenario_data .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),_.wc_cp_select2(),s.wc_cp_select2(),_.wc_cp_select2_component_options(),s.wc_cp_select2_component_options(),e.length>0&&t.each(e,function(t,e){window.alert(e)}),m.unblock(),v.unblock()})},"json")},250)})});