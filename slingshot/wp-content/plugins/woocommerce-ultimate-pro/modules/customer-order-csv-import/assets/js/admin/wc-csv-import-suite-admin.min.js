(function(){"use strict";jQuery(document).ready(function(a){var b;return b=function(b){return a.get(ajaxurl,{action:"wc_plugin_framework_csv_import_suite_dismiss_notice",messageid:"wc_csv_import_suite_finished_"+b})},wc_csv_import_suite.draw_results_chart=function(b){var c,d,e;if(e=[],wc_csv_import_suite.status_counts&&(c=a(".chart-placeholder.import-results"),c.length))return a.each(wc_csv_import_suite.status_counts,function(a,b){return e.push({label:wc_csv_import_suite.chart_legends[a].title,color:wc_csv_import_suite.chart_legends[a].color,data:b})}),"undefined"!==b&&e[b]&&(d=e[b],d.color="#9c5d90"),a.plot(c,e,{grid:{hoverable:!0},series:{pie:{show:!0,radius:1,innerRadius:.6,label:{show:!1}},enable_tooltip:!0,append_tooltip:wc_csv_import_suite.i18n.chart_tooltip.replace("%s","")},legend:{show:!1}})},wc_csv_import_suite.display_import_progress=function(c){var d,e,f,g,h,i,j,k,l,m;return i=wc_csv_import_suite.results?Object.keys(wc_csv_import_suite.results):[],h=i?i.length:0,g=i.length?Number(i.pop()):0,l=wc_csv_import_suite.file_size,j=wc_csv_import_suite.progress||0,k=!1,f=!1,e={action:"wc_csv_import_suite_get_progress",security:wc_csv_import_suite.progress_nonce,job_id:c},m={bar:a("#wc-csv-import-suite-progress .bar"),count:a("#wc-csv-import-suite-progress .processed-count"),percentage:a("#wc-csv-import-suite-progress .percentage"),results:a("#wc-csv-import-suite-results")},d=setInterval(function(){if(!k)return k=!0,e.results_from=g+1,a.get(ajaxurl,e).done(function(e){var i,n,o,p;return"string"==typeof e?(n=wc_csv_import_suite.i18n.unexpected_error_message,a(".wrap h2:first").after('<div class="notice notice-error"><p>'+n+"</p></div>"),clearInterval(d)):(j=e.progress||0,o=Math.round(j/l*100),e.results&&(g=Number(Object.keys(e.results).pop()),a.each(e.results,function(b,c){var d;if(!m.results.find("tr.line-"+b).length)return d=a("<span />").text(c.status).text(),n=a("<span />").text(c.message).text(),wc_csv_import_suite.status_counts[d]++,h++,m.results.find("li."+d+" .amount").text(wc_csv_import_suite.status_counts[d]),"skipped"!==d&&"failed"!==d||(m.results.find(".results-details > tbody").append('<tr class="line-'+b+" "+d+'"><td>'+b+"</td><td>"+wc_csv_import_suite.chart_legends[d].label+"</td><td>"+n+"</td></tr>"),f)?void 0:(m.results.find(".js-wc-csv-import-suite-results-details-link-widget").show(),f=!0)})),m.count.text(h),m.percentage.text(o+" %"),m.bar.css("width",o+"%"),wc_csv_import_suite.draw_results_chart(),k=!1,j>=l?(clearInterval(d),j=l,p=wc_csv_import_suite.status_counts.failed||wc_csv_import_suite.status_counts.skipped,i=p?"notice-warning":"notice-success",n=wc_csv_import_suite.i18n.import_complete,p&&(n+=" "+wc_csv_import_suite.i18n.skipped_or_failed_lines),a("h2:first").after('<div class="notice '+i+'"><p>'+n+"</p></div>"),a(".notice-dry-run p").html(wc_csv_import_suite.i18n.dry_run_complete),a(".progress-bar .js-spinner").fadeOut(),a(".js-notice-safe-to-leave-screen").remove(),b(c)):void 0)}).fail(function(b,c,d){var e;return e=wc_csv_import_suite.i18n.unexpected_error_message,a(".wrap h2:first").after('<div class="notice notice-error"><p>'+e+"</p></div>")})},1e3)},a(".js-wc-csv-import-suite-toggle-results-details").click(function(b){var c;return b.preventDefault(),a("#wc-csv-import-suite-results").find(".results-details").toggle(),c=a("#wc-csv-import-suite-results").find(".results-details").is(":visible"),a(this).find(".js-wc-csv-import-suite-toggle-results-details-text").text(c?wc_csv_import_suite.i18n.hide_details:wc_csv_import_suite.i18n.show_details)}),a(".js-wc-csv-import-suite-highlight-series").hover(function(){return wc_csv_import_suite.draw_results_chart(a(this).data("series"))},function(){return wc_csv_import_suite.draw_results_chart()}),a(window).resize(function(){return function(){var a;return clearTimeout(a),a=setTimeout(function(){return a=null,wc_csv_import_suite.draw_results_chart()},100)}}()),a("body").on("click","input.js-wc-csv-import-suite-merge",function(b){var c,d;return c=a(this).is(":checked"),d=c?"show":"hide",a("#wc-csv-import-suite-insert-non-matching").closest("tr")[d]()}),a("body").on("change","select.js-wc-csv-import-suite-delimiter",function(b){var c,d;return d=a(this).val(),a(".wc-csv-import-suite-preview-container").block({message:null,overlayCSS:{opacity:.3}}),c={action:"wc_csv_import_suite_get_preview",security:wc_csv_import_suite.preview_nonce,delimiter:d,file:a(".js-wc-csv-import-suite-file").val()},a.get(ajaxurl,c,function(b){return a("#wc-csv-import-suite-preview").html(b),a(".wc-csv-import-suite-preview-container").unblock()})})})}).call(this);