!function(a,b){a(function(){function c(){var b="";WCPhotographyBatchUploadParams.ajax_loading_image&&(b=" url("+WCPhotographyBatchUploadParams.ajax_loading_image+") no-repeat center"),a("#wc-photography-image-edit .postbox").block({message:null,overlayCSS:{background:"#fff"+b,opacity:.6}})}function d(){a("#wc-photography-image-edit .postbox").unblock()}function e(b){b||(b=a(".wc-photography-collections-select")),b.trigger("change.select2"),b=a(b).filter(":not(.enhanced)");var c={placeholder:WCPhotographyBatchUploadParams.search_placeholder,minimumInputLength:2,multiple:!0,ajax:{url:WCPhotographyBatchUploadParams.ajax_url,dataType:"json",quietMillis:200,data:function(a){return{term:WCPhotographyBatchUploadParams.isLessThanWC30?a:a.term,action:"wc_photography_search_collections",security:WCPhotographyBatchUploadParams.search_collections_nonce}},processResults:function(a){return{results:a}}}};WCPhotographyBatchUploadParams.isLessThanWC30&&(c.initSelection=function(b,c){var d=a.parseJSON(b.attr("data-selected"));return c(d)},c.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"},c.ajax.results=c.ajax.processResults),b.select2(c).addClass("enhanced")}function f(b,c,d){var e;e=d?pluploadL10n.big_upload_queued.replace("%s",c.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",c.name),a("#wc-photography-uploader-error").html('<div class="error"><p>'+e+"</p></div>"),b.removeFile(c)}var g=1;a("#wc-photography-uploader .drag-drop-inside").append('<div class="wc-photography-progress-bar"><div></div></div>'),e();var h=new plupload.Uploader(WCPhotographyBatchUploadParams.plupload),i=a("#wc-photography-uploader .wc-photography-progress-bar"),j=a("#wc-photography-uploader .wc-photography-progress-bar div"),k=a("#wc-photography-uploader-output");h&&(h.bind("init",function(b){var c=a("#wc-photography-uploader-upload-ui");b.features.dragdrop&&!a(document.body).hasClass("mobile")?(c.addClass("drag-drop"),a("#wc-photography-drag-drop-area").bind("dragover.wp-uploader",function(){c.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){c.removeClass("drag-over")})):(c.removeClass("drag-drop"),a("#wc-photography-drag-drop-area").unbind(".wp-uploader")),"html4"===b.runtime&&a(".upload-flash-bypass").hide()}),h.init(),h.bind("filesAdded",function(b,c){var d=104857600,e=parseInt(b.settings.max_file_size,10);a("#wc-photography-uploader-error").html(""),a("#wc-photography-uploader .form-table :input").attr("disabled","disabled"),a(i).show().css("display","block"),plupload.each(c,function(a){e>d&&a.size>d&&"html5"!==b.runtime&&f(b,a,!0)}),b.refresh(),b.start()}),h.bind("uploadProgress",function(b){a(j).css("width",b.total.percent+"%")}),h.bind("fileUploaded",function(c,d,f){var h=a("#wc-photography-batch-collection");if(WCPhotographyBatchUploadParams.isLessThanWC30)h=h.val();else{var i=h.select2("data");h=[],i.forEach(function(a){h.push(a.id)}),h=h.join(",")}a.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_batch_upload",security:WCPhotographyBatchUploadParams.batch_upload_nonce,image_id:f.response,sku_pattern:a("#wc-photography-batch-sku").val(),price:accounting.unformat(a("#wc-photography-batch-price").val(),woocommerce_admin.mon_decimal_point),collections:h},type:"POST",dataType:"json",success:function(c){a(k).append(c);var d=b.template(a("script#wc-photography-image-template").html());c.index=g,a("#wc-photography-image-edit .wc-metaboxes").append(d(c)),e(),g++}})}),h.bind("uploadComplete",function(){a(i).hide().css("display","none"),a(j).removeAttr("style"),a("#wc-photography-image-edit").css("display","block"),a("#wc-photography-uploader .form-table :input").removeAttr("disabled")}),h.bind("error",function(b,c){var d,e=104857600,g=a("#wc-photography-uploader-error");switch(c.code){case plupload.FAILED:case plupload.FILE_EXTENSION_ERROR:g.html('<p class="error">'+pluploadL10n.upload_failed+"</p>");break;case plupload.FILE_SIZE_ERROR:f(b,c.file);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(b,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(b,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(b,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:d=parseInt(plupload.settings.max_file_size,10),d>e&&b.size>e?wpFileError(b,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:a(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(b,pluploadL10n.default_error)}b.refresh()}),a(".wc-metaboxes-wrapper").on("click",".wc-metabox h3",function(){a(this).next(".wc-metabox-content").toggle()}).on("click",".expand_all",function(){return a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").show(),!1}).on("click",".close_all",function(){return a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .wc-metabox-content").hide(),!1}),a(".wc-metabox.closed").each(function(){a(this).find(".wc-metabox-content").hide()}),a("body").on("click","#wc-photography-image-edit .wc-metabox .remove",function(){var b=a(this).closest(".wc-metabox");return c(),a.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_delete_image",security:WCPhotographyBatchUploadParams.delete_image_nonce,id:b.attr("data-id")},type:"POST",success:function(){b.remove(),0===a("#wc-photography-image-edit .wc-metabox").length&&a("#wc-photography-image-edit").hide(),d()}}),!1}).on("click","#wc-photography-image-edit .submit .button",function(){var b=a("#wc-photography-image-edit .wc-metaboxes :input").serialize();return c(),a.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_save_images",security:WCPhotographyBatchUploadParams.save_images_nonce,images:b},type:"POST",success:function(){var b=a("#wc-photography-image-edit");a("div.updated",b).remove(),b.prepend('<div class="updated"><p>'+WCPhotographyBatchUploadParams.edit_success_message+"</p></div>"),a("html, body").animate({scrollTop:b.offset().top-100},500),d()}}),!1}).on("keyup","#wc-photography-image-edit .sku-field",function(){var b=a(this).closest(".wc-metabox"),c=b.attr("data-index");a(".image-name",b).html(c+". "+a(this).val())}).on("click",".photography-add-collection a",function(){return a(this).next(".fields").toggle(),!1}).on("click",".photography-add-collection .button",function(){var b=a(this),c=b.closest(".collection-form-field"),d=a("input.new-collection",c),f=d.val();return""===f?(d.focus(),!1):(d.attr("disabled","disabled"),b.attr("disabled","disabled").next(".message").remove(),b.after(' <i class="loading">'+WCPhotographyBatchUploadParams.loading+"</i>"),a.ajax({url:WCPhotographyBatchUploadParams.ajax_url,data:{action:"wc_photography_add_collection",security:WCPhotographyBatchUploadParams.add_collection_nonce,name:f},type:"POST",dataType:"json",success:function(f){if(d.val(""),d.removeAttr("disabled"),b.removeAttr("disabled").next(".loading").remove(),f.success)if(WCPhotographyBatchUploadParams.isLessThanWC30){var g=a("input.wc-photography-collections-select",c),h=[],i=[];a(".selected-option",c).each(function(b,c){var d=a(c);h.push({id:d.attr("data-id"),text:d.text()}),i.push(d.attr("data-id"))}),h.push(f.data),i.push(f.data.id),g.attr("data-selected",JSON.stringify(h)).val(i.toString()),e(g),a(".fields",c).toggle()}else{var g=a(".wc-photography-collections-select"),j=new Option(f.data.text,f.data.id);j.selected=!0,g.append(j)}else b.after('<div class="error inline message">'+WCPhotographyBatchUploadParams.collection_error+"</div>")}}),!1)}).on("select2-selecting",".wc-photography-collections-select",function(b){var c=a(this).prev(".wc-photography-collections-select"),d=[];a(".selected-option",c).each(function(b,c){var e=a(c);d.push({id:e.attr("data-id"),text:e.text()})}),d.push({id:b.choice.id,text:b.choice.text}),a(this).attr("data-selected",JSON.stringify(d))}).on("select2-removed",".wc-photography-collections-select",function(){var b=a(this).prev(".wc-photography-collections-select"),c=[];a(".selected-option",b).each(function(b,d){var e=a(d);c.push({id:e.attr("data-id"),text:e.text()})}),a(this).attr("data-selected",JSON.stringify(c))}))})}(jQuery,_);
